<div class="navbar navbar-inverse set-radius-zero">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
                <img src="/media/hello_world.jpg" width="200" class="img-logo" />
            </a>
        </div>
    </div>
</div>
<!-- LOGO HEADER END-->
<section class="menu-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="navbar-collapse collapse ">

                </div>
            </div>
        </div>
    </div>
</section>
<!-- MENU SECTION END-->
<div class="content-wrapper">
    <div class="container-md">
        <div class="row" style="margin: 0 auto;">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <h1>Nhập học trở lại - Nhập học từ đầu</h1>
                <form role="form">
                    <h2>Thông tin sinh viên</h2>
                    <div class="form-group ">
                        <label class="control-label" for="name">Ngày đề nghị</label>
                        <input disabled type="date" class="form-control" id="createdAt" name="createdAt" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="studentCode">Mã sinh viên</label>
                        <input disabled class="form-control" onchange="studentService_getStudentInfo(this.value)"
                            type="text" name="studentCode" id="studentCode" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="fullname">Họ và tên</label>
                        <input disabled class="form-control" type="text" name="fullname" id="fullname" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="email">Email</label>
                        <input disabled class="form-control" type="text" name="email" id="email" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label">Chuyên ngành</label>
                        <select disabled class="form-control" id="course" name="course"
                            onchange="studentService_onChangeCourse(this.value)">
                        </select>
                        <input class="form-control" type="hidden" name="courseFee" id="courseFee" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="dropout">Quyết định thôi học</label>
                        <input disabled class="form-control" type="text" name="dropout" id="dropout" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label">Kỳ thứ thôi học</label>
                        <select disabled class="form-control" id="dropoutAtSemester" name="dropoutAtSemester">
                        </select>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="rejoinAcademicYear">Khóa nhập học</label>
                        <input disabled class="form-control" type="text" name="rejoinAcademicYear"
                            id="rejoinAcademicYear" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="mobile">Số điện thoại</label>
                        <input disabled class="form-control" type="text" name="mobile" id="mobile" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="feeDeadline">Hạn đóng</label>
                        <input disabled type="date" class="form-control" id="feeDeadline" name="feeDeadline" />
                    </div>

                    <h2>Thông tin tư vấn</h2>
                    <div class="form-group ">
                        <label class="control-label" for="newCoursePlanning">Khung chương trình học mới (nếu có)</label>
                        <select class="form-control" id="newCoursePlanning" name="newCoursePlanning"
                            onchange="renderStudyPlanning()">
                        </select>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="newAtSemester">Kỳ thứ mới</label>
                        <select class="form-control" id="newAtSemester" name="newAtSemester"
                            onchange="renderStudyPlanning()">
                        </select>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="newStudentStatus">Trạng thái mới</label>
                        <select class="form-control" id="newStudentStatus" name="newStudentStatus"
                            onchange="renderStudyPlanning()">
                        </select>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="startAtSemester">Học kỳ bắt đầu</label>
                        <input class="form-control" type="text" name="startAtSemester" id="startAtSemester"
                            onchange="renderStudyPlanning()" />
                    </div>

                    <h2>Kế hoạch học tập</h2>
                    <div class="form-group ">
                        <button id="buttonAddSem" onclick="onAddSem()" data-target="#modalAddSem" data-toggle="modal"
                            type="button" class="btn btn-link">Thêm học kỳ</button>

                    </div>
                    <div class="form-group">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Học kỳ<p style="font-size: 11px; color: red;">(1)</p>
                                    </th>
                                    <th>Level Tiếng Anh<p style="font-size: 11px; color: red;">(2)</p>
                                    </th>
                                    <th>Mã môn học được miễn/quy đổi tương đương<p style="font-size: 11px; color: red;">
                                            (3)</p>
                                    </th>
                                    <th>Mã môn học bổ sung<p style="font-size: 11px; color: red;">(4)</p>
                                    </th>
                                    <th>Mã môn học lại/thi lại<p style="font-size: 11px; color: red;">(5)</p>
                                    </th>
                                    <th>Học phí phải nộp<p style="font-size: 11px; color: red;">(6) = (1)+(2)-(3)+(4)
                                        </p>
                                    </th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="semester-list">
                                <tr id="semester-1">
                                    <td>Kỳ 1</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-2">
                                    <td>Kỳ 2</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-3">
                                    <td>Kỳ 3</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-4">
                                    <td>Kỳ 4</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-5">
                                    <td>Kỳ 5</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-6">
                                    <td>Kỳ 6</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-7">
                                    <td>Kỳ 7</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="educationNotes">Tư vấn chi tiết</label>
                        <p type="text" name="educationNotes" id="educationNotes" style="font-size: 20px;
                                    font-weight: bold;
                                    color: red;
                                    font-style: italic;" />
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="totalFee_">Tổng phí</label>
                        <p type="text" name="totalFee_" id="totalFee_" style="font-size: 20px;
                                    font-weight: bold;
                                    color: red;
                                    font-style: italic;" />
                    </div>

                    <div class="form-group modal-footer">
                        <a href="/dao-tao/nhap-hoc-tro-lai" class="btn btn-default">Quay lại</a>
                        <button id="buttonSave" onclick="education_onSaveUpdateRejoinPaper()" type="button"
                            class="btn btn-primary">Lưu</button>
                    </div>
                </form>
            </div>
            <div class="col-md-2"></div>
        </div>
    </div>
</div>



<!-- CONTENT-WRAPPER SECTION END-->
<section class="footer-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                &copy; 2022 Ít nhưng dài lâu
            </div>
        </div>
    </div>
</section>


<div class="modal fade" id="modalAddSem" tabindex="-1" role="dialog" aria-labelledby="modalAddSemLabel"
    aria-hidden="true">
    <div class="modal-dialog" style="overflow-y: scroll;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="modalAddSemLabel">Thông tin kỳ học</h4>
            </div>
            <div class="modal-body">
                <form id="course_form">
                    <div class="row">
                        <div class="form-group col-md-12">
                            <label for="form_semester">Kỳ học</label>
                            <select class="form-control" id="form_semester">

                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-4">
                            <label for="form_english_level">Level Tiếng Anh</label>
                            <select class="form-control" id="form_english_level">
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="form_english_status">Tình trạng</label>
                            <select class="form-control" id="form_english_status">
                            </select>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="form_english_fee">Mức phí</label>
                            <select class="form-control" id="form_english_fee">
                            </select>
                        </div>
                    </div>

                    <div class="form-group ">
                        <label class="control-label" for="new_course_subjects_input">Môn miễn giảm
                            <span class="btn btn-link" onclick="initModal(1)" data-target="#myModal"
                                data-toggle="modal">Chọn</span>
                        </label>

                        <ul id="finished-subjects">

                        </ul>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="new_course_subjects_input">Môn bổ sung
                            <span class="btn btn-link" onclick="initModal(2)" data-target="#myModal"
                                data-toggle="modal">Chọn</span>
                        </label>

                        <ul id="new-subjects">

                        </ul>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="new_course_subjects_input">Môn học lại
                            <span class="btn btn-link" onclick="initModal(3)" data-target="#myModal"
                                data-toggle="modal">Chọn</span>
                        </label>

                        <ul id="retake-subjects">

                        </ul>
                    </div>
                    <div class="form-group ">
                        <label class="control-label" for="new_course_subjects_input">Môn thi lại
                            <span class="btn btn-link" onclick="initModal(4)" data-target="#myModal"
                                data-toggle="modal">Chọn</span>
                        </label>

                        <ul id="retest-subjects">

                        </ul>
                    </div>



                </form>
            </div>
            <div class="form-group modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button onclick="education_onSaveSemester()" data-dismiss="modal" type="button"
                    class="btn btn-primary">Chọn</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModal" aria-hidden="true">
    <div class="modal-dialog" style="overflow-y: scroll;">
        <div class="modal-content" id="modal-content">

        </div>
    </div>
</div>



<script src="/js/rejoin.js"></script>
<script>
    let _courses = {{{ _courses }}};
    let _newCourses = {{{ _newCourses }}};
    let _oneCampaign = {{{ _oneCampaign }}};
    let _type = {{{ _type }}};
    let _rejoinStudentStatus = {{{ _rejoinStudentStatus }}};
    let _newStudentStatus = {{{ _newStudentStatus }}};
    let _englishProps = {{{ _englishProps }}};
    let _subjects = {{{ _subjects }}};
    let _semesterProps = {{{ _semesterProps }}};
    let _paper = {{{ _paper }}};

    rejoinPaper = { ...rejoinPaper, ..._paper };
    nextPartSecond = { ...nextPartSecond, ..._paper.nextPartSecond };

    let finishedSubjects = [], newSubjects = [], retakeSubjects = [], retestSubjects = [];
    let english = {};

    const education_removeSemester = i => {
        nextPartSecond.studyPlanning.splice(i, 1);
        renderStudyPlanning();
    }

    const renderStudyPlanning = (sp = nextPartSecond.studyPlanning) => {
        let html = '';
        html = ` <tr id="semester-1">
                                    <td>Kỳ 1</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-2">
                                    <td>Kỳ 2</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-3">
                                    <td>Kỳ 3</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-4">
                                    <td>Kỳ 4</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-5">
                                    <td>Kỳ 5</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>                                 
                                </tr>
                                <tr id="semester-6">
                                    <td>Kỳ 6</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>
                                <tr id="semester-7">
                                    <td>Kỳ 7</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                    <td>...</td>
                                </tr>`
        $('#semester-list').html(html);

        let educationNotes = '', totalFee = Number(_newCourses.find(i => i.value.toString() == $('#newCoursePlanning').val().toString())?.fee || 0);
        educationNotes += `<p> ${_newStudentStatus.find(i => i.VALUE.toString() == $('#newStudentStatus').val().toString())?.NAME} 
            Kỳ ${$('#newAtSemester').val()} 
            ngành ${_newCourses.find(i => i.value.toString() == $('#newCoursePlanning').val().toString())?.displayName} 
            tại ${$('#startAtSemester').val()}.</p>`;
        sp.sort((a, b) => a.semester.localeCompare(b.semester));
        for (let i = 0; i < sp.length; i++) {
            const sem = sp[i];
            let html = '', text = '', semesterFee = 0;
            let index = _semesterProps.sems.findIndex(x => x.value == sem.semester);
            if (index != -1) {
                semesterFee = Number(_newCourses.find(i => i.value.toString() == $('#newCoursePlanning').val().toString())?.fee || 0);
                text = `<p>Học kỳ ${index + 1}`;
                if (sem.english.level && sem.english.fee && sem.english.status) {
                    semesterFee += Number(sem.english.fee);
                }
                let retestSubjects = '', retakeSubjects = '', newSubjects = '', finishedSubjects = '';
                if (sem.retestSubjects.length > 0) {
                    retestSubjects = sem.retestSubjects.map(x => `<p>${x.name}(${x.parts}P)</p>`).join('');
                }
                if (sem.retakeSubjects.length > 0) {
                    retakeSubjects = sem.retakeSubjects.map(x => `<p>${x.name}</p>`).join('');
                }
                if (sem.newSubjects.length > 0) {
                    text += '. Môn bổ sung: ';
                    semesterFee += Number(sem.newSubjects.reduce((a, b) => a + Number(b.fee), 0));
                    text += sem.newSubjects.map(x => `<span>${x.name}</span>`).join(', ');
                    newSubjects = sem.newSubjects.map(x => `<p>${x.name}: ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(x.fee)}</p>`).join('');
                }
                if (sem.finishedSubjects.length > 0) {
                    text += '. Môn miễn giảm: ';
                    semesterFee -= Number(sem.finishedSubjects.reduce((a, b) => a + Number(b.fee), 0));
                    text += sem.finishedSubjects.map(x => `<span>${x.name}</span>`).join(', ');
                    finishedSubjects = sem.finishedSubjects.map(x => `<p>${x.name}: ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(x.fee)}</p>`).join('');
                }
                html += `
                    <td>
                        <p>${sem.semester}</p>
                    </td>
                    <td>
                        ${sem.english.level && sem.english.fee && sem.english.status && `
                            <p>Dự thu ${sem.english.status}</p>
                            <p>${sem.english.level}: ${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(sem.english.fee)}</p>
                        `}                        
                    </td>
                    <td>${finishedSubjects}</td >
                    <td>${newSubjects} </td>
                    <td>
                        <p>${retakeSubjects}</p>
                        <p>${retestSubjects}</p>
                    </td>
                    <td>${new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(semesterFee)}</td>
                    <td>
                        <button type="button" class="btn btn-link" onclick="education_removeSemester(${i})">Xoá</button>
                    </td>`
                if (sem.english.level && sem.english.fee && sem.english.status) {
                    text += `. Dự thu ${sem.english.status} Tiếng Anh - ${sem.english.level}`
                }
                text += '.</p>';
                $(`#semester-${index + 1}`).html(html);
                educationNotes += text;
            }
            totalFee += semesterFee;
        }
        educationNotes += '<p>Sinh viên tự đăng ký học lại hoặc thi lại trên AP.</p>';
        $('#educationNotes').html(educationNotes);
        $('#totalFee_').html(new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(totalFee));
        nextPartSecond.totalFee = totalFee;
    }

    const onAddSem = () => {
        let html = '';
        for (let i = 0; i < _semesterProps.sems.length; i++) {
            let check = nextPartSecond.studyPlanning.filter(item => item.semester.toString() == _semesterProps.sems[i].name.toString()).length > 0;
            if (check) continue;
            html += `<option value = "${_semesterProps.sems[i].value}" > ${_semesterProps.sems[i].name}</option> `
        }
        $('#form_semester').html(html);

        html = '';
        for (let i = 0; i < _englishProps.levels.length; i++) {
            html += `<option value = "${_englishProps.levels[i].value}" > ${_englishProps.levels[i].name}</option> `
        }
        $('#form_english_level').html(html);

        html = '';
        for (let i = 0; i < _englishProps.status.length; i++) {
            html += `<option value = "${_englishProps.status[i].value}" > ${_englishProps.status[i].name}</option> `
        }
        $('#form_english_status').html(html);

        html = '';
        for (let i = 0; i < _englishProps.fees.length; i++) {
            html += `<option value = "${_englishProps.fees[i].value}" > ${_englishProps.fees[i].name}</option>`
        }
        $('#form_english_fee').html(html);

    }

    const education_removeSubjects = (subject, type = 1) => {
        if (type == 1) {
            let index = finishedSubjects.findIndex(x => x.name == subject);
            if (index > -1) {
                finishedSubjects.splice(index, 1);
            }
        } else if (type == 2) {
            let index = newSubjects.findIndex(x => x.name == subject);
            if (index > -1) {
                newSubjects.splice(index, 1);
            }
        } else if (type == 3) {
            let index = retakeSubjects.findIndex(x => x.name == subject);
            if (index > -1) {
                retakeSubjects.splice(index, 1);
            }
        } else if (type == 4) {
            let index = retestSubjects.findIndex(x => x.name == subject);
            if (index > -1) {
                retestSubjects.splice(index, 1);
            }
        }
        education_renderSubjects(type);
    }

    const education_renderSubjects = (type = 1) => {
        studentService_calculateTotalFee();
        let subjects = type == 1 ? finishedSubjects :
            type == 2 ? newSubjects :
                type == 3 ? retakeSubjects : retestSubjects;
        let id = type == 1 ? 'finished-subjects' :
            type == 2 ? 'new-subjects' :
                type == 3 ? 'retake-subjects' : 'retest-subjects';
        let html = ``;
        for (let i = 0; i < subjects.length; i++) {
            const item = subjects[i];
            if (type == 1) {
                html += `<span class="btn">${item.name}</span> - <span>${formatCurrency(item.fee)}</span>
                -<span class="btn btn-link"  onclick="education_removeSubjects('${item.name}', ${type})">Xoá</span>`;
            } else if (type == 2) {
                html += `<span class="btn">${item.name}</span> - <span>${formatCurrency(item.fee)}</span>
            -<span class="btn btn-link"  onclick="education_removeSubjects('${item.name}', ${type})">Xoá</span>`;
            } else if (type == 3) {
                html += `<span class="btn">${item.name}</span> - <span>${formatCurrency(item.fee)}</span>
            -<span class="btn btn-link"  onclick="education_removeSubjects('${item.name}', ${type})">Xoá</span>`;
            } else if (type == 4) {
                html += `<span class="btn">${item.name}(${item.parts}P)</span> - <span>${formatCurrency(item.fee)}</span>
            -<span class="btn btn-link"  onclick="education_removeSubjects('${item.name}', ${type})">Xoá</span>`;
            }
        }
        $(`#${id}`).html(html);
    }

    // type = 1: miễn giảm, 2: bổ sung, 3: học lại, 4: thi lại
    const eudcation_saveSubjects = (type = 1) => {
        if (type == 1) {
            finishedSubjects = [];
        } else if (type == 2) {
            newSubjects = [];
        } else if (type == 3) {
            retakeSubjects = [];
        } else if (type == 4) {
            retestSubjects = [];
        }

        const subjects = $("input[name='new_courses']");
        for (let i = 0; i < subjects.length; i++) {
            let item = subjects[i];
            if (item.checked) {
                if (type == 1) {
                    let fee = $(`#hidden${item.value}`).val();
                    finishedSubjects.push({ name: item.value, fee: fee });
                } else if (type == 2) {
                    let fee = $(`#hidden${item.value}`).val();
                    newSubjects.push({ name: item.value, fee: fee });
                } else if (type == 3) {
                    let fee = $(`#hidden${item.value}`).val();
                    retakeSubjects.push({ name: item.value, fee: fee });
                } else if (type == 4) {
                    let fee = $(`#hidden${item.value}`).val();
                    let parts = $(`input[name='radio${item.value}']:checked`).val();
                    retestSubjects.push({ name: item.value, fee: fee, parts: parts });
                }
            }
        }
        education_renderSubjects(type);
    }

    const education_initRetakeSubjects = (arr) => {
        let modalContent = `
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Danh sách môn học</h4>
    </div>
    <div class="modal-body text-center">
        <form id="course_form">
            <div class="new_subjects_container" id="new_subjects_container">
    `;

        for (let i = 0; i < arr.length; i++) {
            const c = arr[i];
            modalContent += `
                <div class="form-check new_course_item">
                    <input class="form-check-input" type="checkbox" id="check${c.code}" name="new_courses" value="${c.code}" onchange="studentService_onChangeRestestSubject(this.value)">
                    <label class="form-check-label" for="check${c.code}"><span>${c.code}</span> - <span>${formatCurrency(c.fee)}</span></label>
                    <input type="hidden" id="hidden${c.code}" value="${c.fee}">
                </div>
            `
        }

        modalContent += `
                    </div>
                </form>
            </div>
            <div class="form-group modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button onclick="eudcation_saveSubjects(3)" data-dismiss="modal" type="button"
                    class="btn btn-primary">Lưu</button>
            </div>
            `;
        $(`#modal-content`).html(modalContent);
    }

    const education_initNewSubjects = (arr) => {
        let modalContent = `
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Danh sách môn học</h4>
    </div>
    <div class="modal-body text-center">
        <form id="course_form">
            <div class="new_subjects_container" id="new_subjects_container">
    `;

        for (let i = 0; i < arr.length; i++) {
            const c = arr[i];
            modalContent += `
                <div class="form-check new_course_item">
                    <input class="form-check-input" type="checkbox" id="check${c.code}" name="new_courses" value="${c.code}" onchange="studentService_onChangeRestestSubject(this.value)">
                    <label class="form-check-label" for="check${c.code}">
                        <span>${c.code}</span> - <span>${formatCurrency(c.fee)}</span>
                    </label>
                    <input type="hidden" id="hidden${c.code}" value="${c.fee}">
                </div>
            `
        }

        modalContent += `
                    </div>
                </form>
            </div>
            <div class="form-group modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button onclick="eudcation_saveSubjects(2)" data-dismiss="modal" type="button"
                    class="btn btn-primary">Lưu</button>
            </div>
            `;
        $(`#modal-content`).html(modalContent);
    }

    const education_initFinishedSubjects = (arr) => {
        let modalContent = `
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Danh sách môn học</h4>
    </div>
    <div class="modal-body text-center">
        <form id="course_form">
            <div class="new_subjects_container" id="new_subjects_container">
    `;

        for (let i = 0; i < arr.length; i++) {
            const c = arr[i];
            modalContent += `
                <div class="form-check new_course_item">
                    <input class="form-check-input" type="checkbox" id="check${c.code}" name="new_courses" value="${c.code}" onchange="studentService_onChangeRestestSubject(this.value)">
                    <label class="form-check-label" for="check${c.code}">
                        <span>${c.code}</span> - <span>${formatCurrency(c.fee)}</span>
                    </label>
                    <input type="hidden" id="hidden${c.code}" value="${c.fee}">
                </div>
            `
        }

        modalContent += `
                    </div>
                </form>
            </div>
            <div class="form-group modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button onclick="eudcation_saveSubjects(1)" data-dismiss="modal" type="button"
                    class="btn btn-primary">Lưu</button>
            </div>
            `;
        $(`#modal-content`).html(modalContent);
    }

    const education_initRetestSubjects = (arr) => {
        let modalContent = `
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Danh sách môn học</h4>
    </div>
    <div class="modal-body text-center">
        <form id="course_form">
            <div class="new_subjects_container" id="new_subjects_container">
    `;

        for (let i = 0; i < arr.length; i++) {
            const c = arr[i];
            modalContent += `
                <div class="form-check new_course_item">
                    <input class="form-check-input" type="checkbox" id="check${c.code}" name="new_courses" value="${c.code}" onchange="studentService_onChangeRestestSubject(this.value)">
                    <label class="form-check-label" for="check${c.code}"><span>${c.code}</span></label>
                    <label><input type="radio" name="radio${c.code}" id="radio${c.code}1" value="1">1 phần</label>
                    <label><input type="radio" name="radio${c.code}" id="radio${c.code}2" value="2">2 phần</label>
                    <input type="hidden" id="hidden${c.code}" value="${c.fee}">
                </div>
            `
        }

        modalContent += `
                    </div>
                </form>
            </div>
            <div class="form-group modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button onclick="eudcation_saveSubjects(4)" data-dismiss="modal" type="button"
                    class="btn btn-primary">Lưu</button>
            </div>
            `;
        $(`#modal-content`).html(modalContent);
    }

    // modal add subjects
    const initModal = (type) => {
        switch (type) {
            case 1:
                education_initFinishedSubjects(_subjects);
                break;
            case 2:
                education_initNewSubjects(_subjects);
                break;
            case 3:
                education_initRetakeSubjects(_subjects);
                break;
            case 4:
                education_initRetestSubjects(_subjects);
                break;
            default:
                break;
        }
    }

    const education_onSaveSemester = () => {
        let oneSem = {
            semester: $(`#form_semester`).val(),
            english: {
                level: $(`#form_english_level`).val(),
                fee: $(`#form_english_fee`).val(),
                status: $(`#form_english_status`).val(),
            },
            retestSubjects, newSubjects, finishedSubjects, retakeSubjects
        }
        nextPartSecond.studyPlanning.push(oneSem);
        renderStudyPlanning();
        retestSubjects = [];
        newSubjects = [];
        finishedSubjects = [];
        retakeSubjects = [];
        education_renderSubjects(1);
        education_renderSubjects(2);
        education_renderSubjects(3);
        education_renderSubjects(4);
    }

    const education_onSaveUpdateRejoinPaper = async () => {
        rejoinPaper = {
            ...rejoinPaper,
            nextPartSecond: {
                ...nextPartSecond,
                newCoursePlanning: $('#newCoursePlanning').val(),
                newAtSemester: $('#newAtSemester').val(),
                newStudentStatus: $('#newStudentStatus').val(),
                startAtSemester: $('#startAtSemester').val()
            }
        }
        console.log(rejoinPaper);

        swal("Xác nhận cập nhật phiếu nhập học?", {
            buttons: {
                cancel: "Hủy",
                confirm: 'Xác nhận',
            },
        })
            .then(async (value) => {
                if (value) {
                    const url = `/api/papers/dao-tao/nhap-hoc-tro-lai/cap-nhat`;

                    const option = {
                        method: 'put',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ rejoinPaper })
                    }
                    try {
                        const result = await fetchAPI(url, option);
                        if (result.error == false) {
                            window.location.href = '/dao-tao/nhap-hoc-tro-lai/'
                        }
                        else {
                            swal("Lỗi", result.message, "error");
                        }
                    } catch (e) { swal(`Lỗi: ${e.message} `); }
                }
            })
    }








    education_initPageTypeTwoForUpdating();
    renderStudyPlanning(nextPartSecond.studyPlanning);


</script>